<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>AR Rotación con Dedo</title>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>

  <!-- AR.js -->
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

  <style>
    body, html {
      margin: 0;
      overflow: hidden;
      touch-action: none; /* Muy importante para evitar bloqueo de gestos */
    }
  </style>

  <!-- Componente personalizado para rotación táctil -->
  <script>
    AFRAME.registerComponent('drag-rotate', {
      schema: { speed: { default: 2 } },
      init: function () {
        this.dragging = false;
        this.prevX = 0;

        document.addEventListener('touchstart', (e) => {
          this.dragging = true;
          this.prevX = e.touches[0].clientX;
        });

        document.addEventListener('touchend', () => {
          this.dragging = false;
        });

        document.addEventListener('touchmove', (e) => {
          if (!this.dragging || !this.el.object3D.visible) return;

          const deltaX = e.touches[0].clientX - this.prevX;
          const rotation = this.el.getAttribute('rotation');
          rotation.y += deltaX * this.data.speed * 0.2;
          this.el.setAttribute('rotation', rotation);

          this.prevX = e.touches[0].clientX;
        });
      }
    });
  </script>

</head>
<body>

<a-scene
  embedded
  vr-mode-ui="enabled: false"
  arjs="sourceType: webcam; debugUIEnabled: false;"
>
  
  <!-- Luces -->
  <a-entity light="type: ambient; intensity: 1.4"></a-entity>
  <a-entity light="type: directional; intensity: 3" position="1 3 2"></a-entity>

  <!-- Cargar modelos -->
  <a-assets>
    <a-asset-item id="naturaleza" src="modelos/Naturaleza.glb"></a-asset-item>
  </a-assets>

  <!-- Marcador y modelo con rotación táctil -->
  <a-marker type="pattern" url="markers/nature.patt">
    <a-entity 
      gltf-model="#naturaleza"
      scale="0.5 0.5 0.5"
      position="0 0 0"
      rotation="0 0 0"
      drag-rotate
    ></a-entity>
  </a-marker>

  <a-entity camera></a-entity>
</a-scene>

</body>
</html>
